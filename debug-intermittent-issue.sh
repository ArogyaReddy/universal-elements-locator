#!/bin/bash

echo "ğŸ” Universal Element Locator - Intermittent Issue Debug"
echo "====================================================="

echo "ğŸ› Issue: Works first time, fails second time"
echo ""
echo "ğŸ”§ Enhanced debugging added:"
echo "   â€¢ Content script logs injection state"
echo "   â€¢ Content script logs elements with IDs, classes, data attributes" 
echo "   â€¢ Content script logs locator counts for first 5 elements"
echo "   â€¢ Content script logs final scan summary"
echo "   â€¢ Popup logs scan response details"
echo "   â€¢ Popup logs what's being saved to storage"
echo "   â€¢ Added storage.clear() before saving new results"
echo ""
echo "ğŸ§ª Testing Steps for Intermittent Issue:"
echo "   1. Load extension in Chrome"
echo "   2. Open test page (e.g., test-results-fix.html)"
echo "   3. Open DevTools (F12) and go to Console tab"
echo "   4. Run FIRST scan - note all console messages"
echo "   5. Run SECOND scan - note differences in console"
echo "   6. Compare the debug output between scans"
echo ""
echo "ğŸ” Key Debug Messages to Watch:"
echo "   CONTENT SCRIPT:"
echo "   â€¢ 'ğŸ” Content: Starting page scan...'"
echo "   â€¢ 'ğŸ” Content: Window injection state: true/false'"
echo "   â€¢ 'ğŸ” Content: Found element with ID: ...'"
echo "   â€¢ 'ğŸ” Content: Element 0 (tagname) locators: {...}'"
echo "   â€¢ 'ğŸ” Content: Scan complete! {...}'"
echo ""
echo "   POPUP SCRIPT:"
echo "   â€¢ 'ğŸ” Popup: Scan response received: {...}'"
echo "   â€¢ 'ğŸ” Popup: Saving scan data: {...}'"
echo ""
echo "   RESULTS SCRIPT:"
echo "   â€¢ 'ğŸ” Debug: Raw storage result: {...}'"
echo "   â€¢ 'ğŸ” Debug: createLocatorsList called with: [...], type'"
echo ""
echo "ğŸ’¡ Expected Behavior:"
echo "   â€¢ FIRST scan: Should see locators being created and displayed"
echo "   â€¢ SECOND scan: Should behave identically to first scan"
echo ""
echo "âŒ If Issue Persists:"
echo "   â€¢ Check if content script injection state changes"
echo "   â€¢ Verify locator creation in content script"
echo "   â€¢ Confirm storage data consistency"
echo "   â€¢ Look for any error messages between scans"
